<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body>
    <input type="text" id="input_title">
    <div id="c"></div>
    <div id="c2"></div>
    <input type="file" id="imgFile">
    <div id="display"></div>
    <script src="js/lib/pixi.js/bin/pixi.min.js"></script>
    <script src="js/lib/stats.js-master/build/stats.min.js"></script>
    <script src="js/banner_creater.js"></script>
    <script>
    var inputTitle;

    var editAreaWidth = 320;
    var editAreaHeight = 320;

    var bannerWidth = 260;
    var bannerHeight = 60;

    var focusArea = {
        x: 0,
        y: 0
    }

    var animeRequest;
   
    var fileInput = document.getElementById('imgFile'),
        fileDisplayArea = document.getElementById('display');

    fileInput.addEventListener('change', function(e) {
        var file = fileInput.files[0];
        var imageType = /image.*/;

        if (file.type.match(imageType)) {
            var reader = new FileReader();

            reader.onload = function(e) {
                fileDisplayArea.innerHTML = "";

                var img = new Image();
                img.src = reader.result;

                fileDisplayArea.appendChild(img);
            }

            reader.readAsDataURL(file);
        }

    })


    inputTitle = document.getElementById('input_title');


    input_title.onblur = function() {
        console.log(this.value);
    }

    PIXI.Texture.Draw = function(cb) {
        var canvas = document.createElement('canvas');
        if (typeof cb == 'function') cb(canvas);
        return PIXI.Texture.fromCanvas(canvas);
    }


    var renderer = new PIXI.autoDetectRenderer(editAreaWidth, editAreaHeight);
    document.getElementById("c").appendChild(renderer.view);
    var stage = new PIXI.Container();

    //--------------------//

    var renderer2 = new PIXI.autoDetectRenderer(bannerWidth, bannerHeight);
    document.getElementById("c2").appendChild(renderer2.view);
    var stage2 = new PIXI.Container();



    var sprite = new PIXI.Sprite(PIXI.Texture.Draw(function(canvas) {

        var ctx = canvas.getContext('2d'); //get  canvas 2D context

        var gradient = ctx.createLinearGradient(0, 0, 200, 0);

        gradient.addColorStop(0, '#726232');
        gradient.addColorStop(0.5, '#726232');
        gradient.addColorStop(1, "transparent");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, bannerWidth, bannerHeight);
    }));


    var loader = PIXI.loader;
    loader.add('actor', "72088_BloodweaverNightWitch_WEB.jpg");
    loader.add('logo', "circle-orboros.png");
    loader.add("satellite", "satellite.fnt");
    loader.add("crackhouse", "crackhouse.fnt");
    loader.add("templar.fnt");
    loader.once('complete', onAssetsLoaded);

    loader.load();


    focusArea.x = editAreaWidth / 2 - bannerWidth / 2
    focusArea.y = editAreaHeight / 2 - bannerHeight / 2


    var unFocusArea = new PIXI.Graphics();

    unFocusArea.beginFill(0x333333);

    unFocusArea.drawRect(0, 0, editAreaWidth, focusArea.y); //top
    unFocusArea.drawRect(0, focusArea.y + bannerHeight, editAreaWidth, focusArea.y); //bottom
    unFocusArea.drawRect(0, focusArea.y, focusArea.x, bannerHeight)
    unFocusArea.drawRect(editAreaWidth - focusArea.x, focusArea.y, focusArea.x, bannerHeight);

    unFocusArea.endFill();

    unFocusArea.alpha = 0.8;




    var actor2;


    function onAssetsLoaded(loader, resources) {
        //  console.log(resources.actor.texture);

        var actor = new PIXI.Sprite(resources.actor.texture);
        actor2 = new PIXI.Sprite(resources.actor.texture)

        actor2.x = -focusArea.x;
        actor2.y = -focusArea.y;
        actor.interactive = true;

        actor.on('mousedown', onDragStart)
            // events for drag end
            .on('mouseup', onDragEnd)
            .on('mouseupoutside', onDragEnd)
            // events for drag move
            .on('mousemove', onDragMove)


        function onDragStart(event) {
            animate();
            this.data = event.data;
            this.dragging = true;
            this.sx = this.data.getLocalPosition(this).x * this.scale.x;
            this.sy = this.data.getLocalPosition(this).y * this.scale.y;

        }

        function onDragEnd() {
            this.dragging = false;
            cancelRequestAnimFrame(animeRequest);
            // set the interaction data to null

            actor2.x = -focusArea.x + this.position.x;
            actor2.y = -focusArea.y + this.position.y;
            renderer2.render(stage2);
            this.data = null;
        }

        function onDragMove() {
            if (this.dragging) {
                var newPosition = this.data.getLocalPosition(this.parent);
                this.position.x = newPosition.x - this.sx;
                this.position.y = newPosition.y - this.sy;
            }
        }


        var logo = new PIXI.Sprite(resources.logo.texture);
        logo.alpha = 0.4;
        logo.x = 0;
        logo.y = (logo.height / -2) + 30;


        var style = {
            font: "50px Arial",
            fill: "red"
        };
        var style = {
            font: "12px Arial",
            fill: "white"
        };
        var text = new PIXI.Text("Bloodweaver Night Witch", style);


        var _textObj = new PIXI.extras.BitmapText("AaBb", {
            font: "30px Templar",
            tint: 0xFFFFFF

        });

        _textObj.x = 13;
        _textObj.y = 5

        text.y = renderer2.height - text.height - 5;
        text.x = 5;
        stage.addChild(actor);
        stage.addChild(unFocusArea);

        stage2.addChild(actor2);
        stage2.addChild(sprite);
        stage2.addChild(logo);
        stage2.addChild(text);
        stage2.addChild(_textObj);




        //stage.addChild(focusArea)
        renderer.render(stage);
        renderer2.render(stage2);
    }

    // animate();

    // var request;

    function animate() {
        animeRequest = requestAnimationFrame(animate);
        
        renderer.render(stage);
        
    }


    window.requestAnimFrame = (function() {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function(callback) {
                window.setTimeout(callback, 1000 / 60);
            };
    })();

    window.cancelRequestAnimFrame = (function() {
        return window.cancelAnimationFrame ||
            window.webkitCancelRequestAnimationFrame ||
            window.mozCancelRequestAnimationFrame ||
            window.oCancelRequestAnimationFrame ||
            window.msCancelRequestAnimationFrame ||
            clearTimeout
    })();

    //



    /*

            var _textObj = new PIXI.extras.BitmapText("00", {
                    font: "50px Crackhouse",
                    tint: 0xFF0000
                });

    */


    //  console.log(stage);

    //console.log(ctx);

    /*

        var gradient = ctx.createLinearGradient(0, 0, 200, 0);
        gradient.addColorStop(0, "green");
        gradient.addColorStop(1, "white");
        ctx.fillStyle = gradient;
        ctx.fillRect(10, 10, 200, 100);
    */

    //  stage.addChild(ctx);
    </script>
</body>

</html>
